name: check

on:
  push:
    branches:
      - "**"
    paths:
      - ".github/workflows/check.yml"
      - "assets/**"
      - "**.py"
  pull_request:
    branches:
      - "**"
    paths:
      - ".github/workflows/check.yml"
      - "assets/**"
      - "**.py"
  workflow_dispatch:

jobs:
  resource:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # pip install maafw
      # 在 requirements.txt 中查找以 maafw 开头的行
      - name: Install maafw (from requirements.txt)
        shell: powershell
        run: |
            python -m pip install --upgrade pip
            $line = Get-Content requirements.txt | Where-Object { $_ -match '^\s*maafw' } | Select-Object -First 1
            if ($line) {
              $pkg = $line.Trim()
            } else {
              $pkg = 'maafw'
            }
            Write-Host "Installing $pkg"
            python -m pip install --upgrade $pkg
      - name: Check Resource
        run: |
            python ./check_resource.py ./assets/resource/
